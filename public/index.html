<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>登录系统示范</title>
</head>
<body>
<h1>注册</h1>
<form id="registerForm">
  用户名：<input type="text" name="username" required />
  密码：<input type="password" name="password" required />
  <button type="submit">注册</button>
</form>

<h1>登录</h1>
<form id="loginForm">
  用户名：<input type="text" name="username" required />
  密码：<input type="password" name="password" required />
  <button type="submit">登录</button>
</form>

<h1>个人信息</h1>
<button id="getProfile">查看个人信息（需登录）</button>
<p id="profile"></p>

<button id="logoutBtn">退出登录</button>

<script>
  const registerForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');
  const getProfileBtn = document.getElementById('getProfile');
  const profileP = document.getElementById('profile');
  const logoutBtn = document.getElementById('logoutBtn');

  registerForm.addEventListener('submit', async e => {
    e.preventDefault();
    const formData = new FormData(registerForm);
    const data = Object.fromEntries(formData);
    const res = await fetch('/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    alert(await res.text());
  });

  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    const formData = new FormData(loginForm);
    const data = Object.fromEntries(formData);
    const res = await fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    alert(await res.text());
  });

  getProfileBtn.addEventListener('click', async () => {
    const res = await fetch('/profile');
    if (res.status === 401) {
      profileP.textContent = '请先登录';
      return;
    }
    const text = await res.text();
    profileP.textContent = text;
  });

  logoutBtn.addEventListener('click', async () => {
    const res = await fetch('/logout', { method: 'POST' });
    alert(await res.text());
  });
</script>
</body>
</html>
